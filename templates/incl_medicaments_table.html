{% csrf_token %}

<div class="col-md-12">
    <div class="row">
        {% include 'incl_modal_create_new_medicament.html' %}
        <button id="add-new-medicament" class="btn btn-success btn-sm" data-toggle="modal" data-target="#exampleModal">Добавить медикамент</button>
    </div>
    <div class="row top-buffer">
        <table id="medicaments-table" class="display compact table-bordered" style="width:100%"></table>
    </div>
</div>

<script>
    var buttonMarkAsUsed = '<button type="button" class="btn btn-danger btn-sm">Израсх.</button>';


    $('#medicaments-table').on( 'click', 'button', function () {
        var currentRow = $(this).closest('tr')[0];
        var id = $(currentRow).attr('id').replace('id', '');
        alert( 'Clicked row id '+id );
    });

    var imageTemplateRenderer = function(data, type, row) {
        var img = '';
        if (data) {
            img = '<img src="' + data + '"  height="50" width="50"/>';
        }
        return img
    };

    $('#add-new-medicament').on( 'click', function () {
{#        $('#medicaments-table').DataTable().ajax.reload();#}
    });

    var tbl = $('#medicaments-table').DataTable({
        ajax: "{% url 'get_medicaments' %}",
        columns: [
            {title: 'ID'},
            {title: 'Название'},
            {title: 'Цена'},
            {title: 'Категория'},
            {title: 'Фото упак.', render: imageTemplateRenderer},
            {title: 'Фото даты', render: imageTemplateRenderer},
            {title: 'Фото рец.', render: imageTemplateRenderer},
            {title: 'Дата созд.'},
            {title: 'Годен до'},
            {title: 'Ком-ий'},
            {title: 'Статус'},
            {
                title: 'Израс-ан',
                targets: -1,
                data: null,
{#                defaultContent: buttonMarkAsUsed#}
                render: function (data, type, row, meta) {
{#                    console.log(data, type, row, meta)#}
                    return buttonMarkAsUsed;
                }
            },
            {
                title: 'Править',
                targets: -1,
                data: null,
                defaultContent: buttonMarkAsUsed
            },

        ],
{#            paging: false,#}
{#            ordering: false,#}
        info: false,
        bSortClasses: false,
        select: true,
        aaSorting: [],
        createdRow: function(nRow, data, dataIndex) {
            $(nRow).attr('id', 'id' + data[0].toString());
        }
        });

</script>
